<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
  
<link rel="stylesheet" href="/css/layout.css">

  <title>
     
      AVL树（一）
     
  </title>
<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id='post'>
    
<link rel="stylesheet" href="/css/post.css">

    
<link rel="stylesheet" href="/css/sidebar.css">

    
<link rel="stylesheet" href="/css/footer.css">

    
<link rel="stylesheet" href="/css/article.css">

    
<link rel="stylesheet" href="/css/btn-to-top.css">
 
    
<script src="/js/article.js"></script>

    
<script src="/js/post.js"></script>

    
<script src="/js/sidebar.js"></script>

    
<script src="/js/footer.js"></script>

    
<script src="/js/btn-to-top.js"></script>
 

    <div class="post-btns">
        <div class="sidebar"><div id="header">
    <div id="sidebar">
        <ul>
            <a href="/">主页</a>
            <a href="/archives">归档</a>
            <a href="#">分类</a>
            <a href="#">tag</a>
        </ul>
    </div>
    <div id="mask"></div>
    <span id="btn-sidebar">&#9776;</span>
</div></div>
        <div class="btn-toc">⇦</div>
    </div>
    <div class="div-toc">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#旋转"><span class="toc-text">旋转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#以height作为平衡判断条件"><span class="toc-text">以height作为平衡判断条件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基本代码"><span class="toc-text">基本代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实现树的旋转"><span class="toc-text">实现树的旋转</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Insert实现"><span class="toc-text">Insert实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Remove实现"><span class="toc-text">Remove实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Insert函数精简"><span class="toc-text">Insert函数精简</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#完整代码附录"><span class="toc-text">完整代码附录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#以Height作为平衡条件"><span class="toc-text">以Height作为平衡条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#以bf作为平衡判断条件"><span class="toc-text">以bf作为平衡判断条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#判断是否为AVL树"><span class="toc-text">判断是否为AVL树</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考链接"><span class="toc-text">参考链接</span></a></li></ol>
    </div>
    <div class="post-foot-grid">
        <div class="post-grid">
            <div class="padding"></div>
            <div class="text">
                <h1 class='tittle'>
                    
                    AVL树（一）
                    
                </h1>
                <div class="article-text">
    <p>这篇文章不适合于从未听说过AVL树的人，适合对AVL树有概念，但是在实现上有困难的人。</p>
<p>AVL树网上的博客一搜一大把，大部分都在讲AVL怎么左旋、右旋的，在这之后就没了，怎么将一个新的元素插入到树中，怎么判断AVL树失衡，怎么判断是哪种失衡，都没有好好提到，而且许多博客根本不讲怎么删除节点。所以，我查阅了各种资料，详细记录了关于AVL树在实现的各种细节，并给出完整的源代码。</p>
<p>如果读者是一个想要学习怎么写AVL树的人，建议按顺序阅读这篇文章，并且一边读一边跟着写代码。在阅读的同时，如果有不理解的地方，可以参考<a href="https://www.cs.usfca.edu/~galles/visualization/AVLtree.html" target="_blank" rel="noopener">这个网站</a>。</p>
<a id="more"></a>

<h2 id="旋转"><a href="#旋转" class="headerlink" title="旋转"></a>旋转</h2><p>首先，最重要的当然是AVL树的旋转了。下面这幅图来自维基百科，把四种情况都详细展示了出来。至于旋转的原理，有兴趣的可以参考<a href="[https://zh.wikipedia.org/wiki/%E6%A0%91%E6%97%8B%E8%BD%AC](https://zh.wikipedia.org/wiki/树旋转)">wiki</a>，这里不进行解释。总之，在实现AVL树之前，需要先记住这四种旋转方式。</p>
<p><img src="/img/AVL%E6%A0%91-1/Tree_Rebalancing.png" alt=""></p>
<table>
<thead>
<tr>
<th>失衡情况</th>
<th>旋转方式</th>
</tr>
</thead>
<tbody><tr>
<td>LL</td>
<td>R</td>
</tr>
<tr>
<td>LR</td>
<td>LR</td>
</tr>
<tr>
<td>RR</td>
<td>L</td>
</tr>
<tr>
<td>RL</td>
<td>RL</td>
</tr>
</tbody></table>
<p>在网上能找到的资料中，AVL树的实现通常有两种版本，一种是使用height，也就是树高作为平衡判断条件；另一种是使用平衡因子balance factor（简写成bf，其实就是左右子树高差值）作为平衡判断条件。其中，使用height的版本要简单一些，我们将从它开始。</p>
<h2 id="以height作为平衡判断条件"><a href="#以height作为平衡判断条件" class="headerlink" title="以height作为平衡判断条件"></a>以height作为平衡判断条件</h2><p>以height作为平衡条件的代码实现参考了github上的<a href="https://github.com/i-square/Data-Structure/blob/master/Chapter04/AVLTree.h" target="_blank" rel="noopener">这份代码</a>。</p>
<h3 id="基本代码"><a href="#基本代码" class="headerlink" title="基本代码"></a>基本代码</h3><p>实现AVL树，第一步自然是定义树的节点。节点的定义如下。出于简化的目的，node的key是一个int类型。node的height记录树高，left和right指针分别指向当前节点的左儿子和右儿子。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;	<span class="comment">//key</span></span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">height</span>;	<span class="comment">//树高</span></span><br><span class="line">    node * left, * right;	<span class="comment">//左右儿子</span></span><br><span class="line">    node(<span class="keyword">int</span> data):data(data), <span class="built_in">height</span>(<span class="number">0</span>), left(<span class="literal">nullptr</span>), right(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>然后，我们需要两个辅助函数，分别用于计算和更新树高。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Height</span><span class="params">(node * root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> root?root-&gt;<span class="built_in">height</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">UpdateHeight</span><span class="params">(node * root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    root-&gt;<span class="built_in">height</span> = <span class="built_in">max</span>(Height(root-&gt;left), Height(root-&gt;right))+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="实现树的旋转"><a href="#实现树的旋转" class="headerlink" title="实现树的旋转"></a>实现树的旋转</h3><p>现在，我们需要实现四种旋转。对于LL失衡，要做的是右旋。其代码如下。</p>
<p><img src="/img/AVL%E6%A0%91-1/LL.png" alt=""></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateR</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * root = *pRoot;</span><br><span class="line">    node * pivot = (*pRoot)-&gt;left;</span><br><span class="line"></span><br><span class="line">    root-&gt;left = pivot-&gt;right;</span><br><span class="line">    pivot-&gt;right = root;</span><br><span class="line">    *pRoot = pivot;</span><br><span class="line">    UpdateHeight(root);</span><br><span class="line">    UpdateHeight(pivot);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>树的一次旋转，会改变这棵树的根节点。一般情况下，我们当前旋转的这棵树是某棵树的子树。这样一来，对这棵子树进行了旋转以后，由于它的根节点改变了，所以需要更新它的父节点parent的left/right指针。所以，我们的RotateR函数接收的参数是node的二维指针，以方便对parent-&gt;left/right进行更新。也就是说，调用该函数需要将这棵子树的父节点的left/right指针的地址传递进来，即<code>&amp;parent-&gt;left/right</code>。</p>
<p>RotateR函数的实现很简单。首先，参照右旋的示意图，对root和pivot的指针进行更新，然后，由于根节点变了，所以parent的指针也要进行更新。最后，旋转可能导致root和pivot的树高发生变化，所以需要对它们的树高进行更新。在更新树高时，注意先更新root、再更新pivot，这样才能保证树高更新的正确性。</p>
<p>依葫芦画瓢，RotateL的代码也很容易被实现出来。如下所示。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateL</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * root = *pRoot;</span><br><span class="line">    node * pivot = (*pRoot)-&gt;right;</span><br><span class="line"></span><br><span class="line">    root-&gt;right = pivot-&gt;left;</span><br><span class="line">    pivot-&gt;left =  root;</span><br><span class="line">    *pRoot = pivot;</span><br><span class="line">    UpdateHeight(root);</span><br><span class="line">    UpdateHeight(pivot);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RotateLR和RotateRL是RotateL和RotateR的不同组合，所以实现这两个函数，只需要按照不同去调用RotateL和RotateR即可，代码见下方。不过，按照下方代码这样实现，一次RotateLR/RotateRL会有两次函数调用，而且其中有些节点的指针会被重复更新，这样效率会稍微有些低下。对性能有更高要求的可以参照LR/RL的旋转方式，直接对各个节点的指针进行更新，而不是调用两次函数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateLR</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    RotateL(&amp;((*pRoot)-&gt;left));</span><br><span class="line">    RotateR(pRoot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateRL</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    RotateR(&amp;((*pRoot)-&gt;right));</span><br><span class="line">    RotateL(pRoot);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Insert实现"><a href="#Insert实现" class="headerlink" title="Insert实现"></a>Insert实现</h3><p>Insert的实现有几个要点：</p>
<ol>
<li>虽然我们用的是int作为key，int类型支持<code>&gt;</code>、<code>&lt;</code>、<code>==</code>等比较方式。但是，为了代码的可扩展性更强，我们参考stl的map，只使用<code>&lt;</code>作为大小的比较方式。换句话说，我们的代码假设key是严格偏序的。</li>
<li>在insert并balance当前子树后，可能会导致上层失衡，如此一来，上层也必须进行balance。换句话说，balance是递归向上进行的，直到某一层没有出现失衡为止。</li>
<li>在balance后，当前子树的树高可能发生变化，从而导致其到根节点路径上的所有节点的树高都可能发生变化，因此在insert后需要对这一路径上的所有节点的树高都进行更新。换句话说，更新树高也是递归向上的。</li>
</ol>
<p>现在，我们来实现Insert。首先要解决的问题是怎么找insert的位置，由于AVL树也是一种BST树，所以它的左子树的值都比当前节点的值小，右儿子都比当前节点的值大。依据这一性质，就能写出Insert函数的大致框架：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pPtr的含义与Rotate函数的参数相同，这里不再解释</span></span><br><span class="line"><span class="comment">//data是将要insert进来的key</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(node ** pPtr, <span class="keyword">int</span> data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//n即是当前子树的root节点</span></span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="comment">//如果当前root节点为空，说明找到了要insert的地方了</span></span><br><span class="line">    <span class="keyword">if</span>(!n)</span><br><span class="line">        *pPtr = <span class="keyword">new</span> node(data);</span><br><span class="line">    <span class="comment">//只使用 &lt; 符号进行比较</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(data &lt; n-&gt;data)</span><br><span class="line">    &#123;</span><br><span class="line">        Insert(&amp;n-&gt;left, data);</span><br><span class="line">        <span class="comment">//todo: 检查失衡并旋转</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//不支持重复key插入，这里就需要判断一下n-&gt;data&lt;data。</span></span><br><span class="line">    <span class="comment">//如果支持重复key插入，这里直接一个else就行（没实证过，但理论上如此）。</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n-&gt;data &lt; data)</span><br><span class="line">    &#123;</span><br><span class="line">        Insert(&amp;n-&gt;right, data);</span><br><span class="line">        <span class="comment">//todo: 检查失衡并旋转</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//balance会导致树高变化，所以路径上的每一个节点都需要更新树高</span></span><br><span class="line">    UpdateHeight(*pPtr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，剩下的问题就是判断是否出现失衡，出现了哪种类型的失衡，以及怎么对子树进行balance。</p>
<ul>
<li>第一个问题，怎么判断失衡。很简单，根据定义，左右节点高度差大于等于2就失衡了。  </li>
<li>第二个问题，判断失衡类型。  <ul>
<li>对于<code>data&lt;n-&gt;data</code>的情况，新的节点加入到了左子树，那么只可能出现LL和LR的失衡。那么怎么判断是LL还是LR呢？  <ul>
<li>第一种办法是比较新值data和n-&gt;left-&gt;data的大小。  <ul>
<li>如果<code>data&lt;n-&gt;left-&gt;data</code>，那么新的节点在n-&gt;left的左子树中，所以是LL失衡。  </li>
<li>反之就是LR失衡了。  </li>
</ul>
</li>
<li>第二种办法是比较n-&gt;left的左右子树的树高。  <ul>
<li>左子树树高大于等于右子树，就是LL失衡。  </li>
<li>反之就是LR失衡。  </li>
</ul>
</li>
</ul>
</li>
<li>对于<code>data&gt;n-&gt;data</code>的情况，判断方式基本相同，这里不再赘述。  </li>
</ul>
</li>
<li>第三个问题，怎么进行balance。这一点在开头已经提过了那四种情况，这里不再赘述。  </li>
</ul>
<p>思考得比较深的读者，可能会发现上面的一个小问题。判断失衡类型的第二种方法中，左子树和右子树树高相同是怎么回事？事实上，在insert的过程中这种情况根本不会发生，这里列举出第二种方法，是为了给remove方法埋个伏笔。</p>
<p>根据上面的描述，我们可以补全Insert的代码了。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(node ** pPtr, <span class="keyword">int</span> data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="keyword">if</span>(!n)</span><br><span class="line">        *pPtr = <span class="keyword">new</span> node(data);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(data &lt; n-&gt;data)</span><br><span class="line">    &#123;</span><br><span class="line">        Insert(&amp;n-&gt;left, data);</span><br><span class="line">        <span class="comment">//判断是否出现失衡</span></span><br><span class="line">        <span class="keyword">if</span>(Height(n-&gt;left)-Height(n-&gt;right)&gt;=<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//判断出现了哪种失衡，也可以注释中的代码进行判断</span></span><br><span class="line">            <span class="comment">//if(Height(n-&gt;left-&gt;left)&gt;=Height(n-&gt;left-&gt;right))</span></span><br><span class="line">            <span class="keyword">if</span>(data &lt; n-&gt;left-&gt;data)</span><br><span class="line">                RotateR(pPtr);	<span class="comment">//LL</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                RotateLR(pPtr);	<span class="comment">//LR</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n-&gt;data &lt; data)</span><br><span class="line">    &#123;</span><br><span class="line">        Insert(&amp;n-&gt;right, data);</span><br><span class="line">        <span class="keyword">if</span>(Height(n-&gt;right)-Height(n-&gt;left)&gt;=<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//与左子树的判断类似，也可以注释中的代码进行判断</span></span><br><span class="line">            <span class="comment">//if(Height(n-&gt;right-&gt;right)&gt;=Height(n-&gt;right-&gt;left))</span></span><br><span class="line">            <span class="keyword">if</span>(n-&gt;right-&gt;data &lt; data)</span><br><span class="line">                RotateL(pPtr);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                RotateRL(pPtr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    UpdateHeight(*pPtr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Remove实现"><a href="#Remove实现" class="headerlink" title="Remove实现"></a>Remove实现</h3><p>remove的实现其实比insert要麻烦，难点在于在remove一个节点后，为了保持树左子树节点的值都比当前节点小，右子树节点的值都比当前节点大这一性质，还需要对树进行平衡操作。</p>
<p>所以，remove的代码实现主要分为两个部分：</p>
<ol>
<li>寻找对应的节点并进行删除操作。  </li>
<li>删除后对树进行再平衡。  </li>
</ol>
<p>先来说第一个问题，寻找合适的节点并进行删除操作。AVL树的删除一个节点的操作和BST的一样，具体如下：</p>
<ol>
<li>如果被删除节点是叶子节点，那么直接删除。  </li>
<li>如果被删除节点只有左儿子或者右儿子节点，那么直接删除该节点，并把它的父亲与它的左/右儿子连在一起。  </li>
<li>如果被删除节点左右儿子都有，那么选择它右儿子中最小的那个节点作为替死鬼，把这个替死鬼的值赋给当前节点，并把替死鬼节点删掉。当然，选择左儿子中最大的那个节点也是可行的。  </li>
</ol>
<p>首先我们根据BST查找一个节点的方式，写出下面的框架代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Remove</span><span class="params">(node ** pRoot, <span class="keyword">int</span> data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pRoot;</span><br><span class="line">    <span class="keyword">if</span>(!n)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(data &lt; n-&gt;data)</span><br><span class="line">    &#123;</span><br><span class="line">        Remove(&amp;n-&gt;left, data);</span><br><span class="line">        UpdateHeight(n);</span><br><span class="line">        <span class="comment">//todo: 检查失衡并旋转</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n-&gt;data &lt; data)</span><br><span class="line">    &#123;</span><br><span class="line">        Remove(&amp;n-&gt;right, data);</span><br><span class="line">        UpdateHeight(n);</span><br><span class="line">        <span class="comment">//todo: 检查失衡并旋转</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//已经找到了满足条件的key对应的节点</span></span><br><span class="line">        <span class="comment">//todo: 删除节点并检查失衡和旋转</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来，补全删除节点的代码。首先，我们需要一个辅助函数来找到右儿子中最小的那个节点，代码如下。这个函数不断地沿着AVL树的左儿子进行移动，直到找到AVL树左下角的那个节点，即AVL树中最小的节点。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> node* <span class="title">FindMin</span><span class="params">(node * root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = root;</span><br><span class="line">    <span class="keyword">while</span>(n-&gt;left)</span><br><span class="line">        n = n-&gt;left;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来，我们继续补全Remove的代码，代码如下。当找到对应的节点后，</p>
<ul>
<li>如果这个节点是中间节点，则需要找到一个替死鬼节点，也就是它右子树中最小的那个节点，这可以通过FindMin函数来进行。在找到这个节点后，将它的值赋给当前节点，然后删除这个替死鬼节点。  </li>
<li>否则，当前节点是只有左/右儿子的节点或者叶子节点，我们只需要下面的短短三行代码就能将其删除。  </li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Remove</span><span class="params">(node ** pRoot, <span class="keyword">int</span> data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">if</span>(data &lt; n-&gt;data)&#123; Remove(&amp;n-&gt;left, data); ... &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n-&gt;data &lt; data)	&#123; Remove(&amp;n-&gt;right, data); ... &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(n-&gt;left &amp;&amp; n-&gt;right)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//当前节点是中间节点</span></span><br><span class="line">            <span class="comment">//寻找替死鬼</span></span><br><span class="line">            node * victim = FindMin(n-&gt;right);</span><br><span class="line">            n-&gt;data = victim-&gt;data;</span><br><span class="line">            <span class="comment">//删除替死鬼节点</span></span><br><span class="line">            Remove(&amp;n-&gt;right, n-&gt;data);</span><br><span class="line">            UpdateHeight(n);</span><br><span class="line">            <span class="comment">//todo: 检查失衡并旋转</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//*pRoot指向的节点只有左/右儿子的节点，或者该节点是叶子节点</span></span><br><span class="line">            node * old = n;</span><br><span class="line">            *pRoot = n-&gt;left?n-&gt;left:n-&gt;right;</span><br><span class="line">            <span class="keyword">delete</span> old;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到现在为止，第一个大问题——寻找对应的节点并进行删除操作，已经被解决了。接下来是再平衡的问题。与Insert类似，这个问题细分为三个小问题：如何判断是否出现失衡，出现了哪种类型的失衡，以及怎么对子树进行balance。判断失衡当然是通过比较左右子树的高度差，大于等于2就失衡。对子树如何进行balance也已经在旋转那一小节讲过了。主要的问题是判断失衡类型，这也与Insert相似。</p>
<ul>
<li>如果是在左子树中删除的节点，那么只可能出现RR和RL失衡。区分RR和RL失衡的办法是比较n-&gt;right的左右子树的树高：左子树树高大于等于右子树，就是RR失衡。反之就是RL失衡。</li>
<li>同样的道理，就能区分出LL和LR失衡了。</li>
</ul>
<p>于是，我们可以写出BalanceRight和BalanceLeft的代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">BalanceRight</span><span class="params">(node ** pPtr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="keyword">if</span>(Height(n-&gt;right)-Height(n-&gt;left)&gt;=<span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Height(n-&gt;right-&gt;right)&gt;=Height(n-&gt;right-&gt;left))</span><br><span class="line">            RotateL(pPtr);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            RotateRL(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">BalanceLeft</span><span class="params">(node ** pPtr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="keyword">if</span>(Height(n-&gt;left)-Height(n-&gt;right)&gt;=<span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Height(n-&gt;left-&gt;left)&gt;=Height(n-&gt;left-&gt;right))</span><br><span class="line">            RotateR(pPtr);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            RotateLR(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来，就可以对Remove的代码进行最终补全了。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Remove</span><span class="params">(node ** pPtr, <span class="keyword">int</span> data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="keyword">if</span>(!n)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(data &lt; n-&gt;data)</span><br><span class="line">    &#123;</span><br><span class="line">        Remove(&amp;n-&gt;left, data);</span><br><span class="line">        UpdateHeight(n);</span><br><span class="line">        BalanceRight(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n-&gt;data &lt; data)</span><br><span class="line">    &#123;</span><br><span class="line">        Remove(&amp;n-&gt;right, data);</span><br><span class="line">        UpdateHeight(n);</span><br><span class="line">        BalanceLeft(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n-&gt;left &amp;&amp; n-&gt;right)</span><br><span class="line">    &#123;</span><br><span class="line">        node * victim = FindMin(n-&gt;right);</span><br><span class="line">        n-&gt;data = victim-&gt;data;</span><br><span class="line">        Remove(&amp;n-&gt;right, n-&gt;data);</span><br><span class="line">        UpdateHeight(n);</span><br><span class="line">        BalanceLeft(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        node * old = n;</span><br><span class="line">        *pPtr = n-&gt;left?n-&gt;left:n-&gt;right;</span><br><span class="line">        <span class="keyword">delete</span> old;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Insert函数精简"><a href="#Insert函数精简" class="headerlink" title="Insert函数精简"></a>Insert函数精简</h3><p>上文提到过，Insert函数判断失衡类型时有两种方式，如果我们采用第二种，即判断当前节点左右子树的高度差是否大于2，那么这一流程将与Remove函数的判断失衡并旋转的代码一模一样。由此，我们可以在Insert函数中也调用BalanceRight和BalanceLeft函数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(node ** pPtr, <span class="keyword">int</span> data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="keyword">if</span>(!n)</span><br><span class="line">        *pPtr = <span class="keyword">new</span> node(data);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(data &lt; n-&gt;data)</span><br><span class="line">    &#123;</span><br><span class="line">        Insert(&amp;n-&gt;left, data);</span><br><span class="line">        BalanceLeft(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n-&gt;data &lt; data)</span><br><span class="line">    &#123;</span><br><span class="line">        Insert(&amp;n-&gt;right, data);</span><br><span class="line">        BalanceRight(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">    UpdateHeight(*pPtr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="完整代码附录"><a href="#完整代码附录" class="headerlink" title="完整代码附录"></a>完整代码附录</h2><h3 id="以Height作为平衡条件"><a href="#以Height作为平衡条件" class="headerlink" title="以Height作为平衡条件"></a>以Height作为平衡条件</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">height</span>;</span><br><span class="line">    node * left, * right;</span><br><span class="line">    node(<span class="keyword">int</span> data):data(data), <span class="built_in">height</span>(<span class="number">0</span>), left(<span class="literal">nullptr</span>), right(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Height</span><span class="params">(node * root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> root?root-&gt;<span class="built_in">height</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">UpdateHeight</span><span class="params">(node * root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    root-&gt;<span class="built_in">height</span> = <span class="built_in">max</span>(Height(root-&gt;left), Height(root-&gt;right))+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateR</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * root = *pRoot;</span><br><span class="line">    node * pivot = (*pRoot)-&gt;left;</span><br><span class="line"></span><br><span class="line">    root-&gt;left = pivot-&gt;right;</span><br><span class="line">    pivot-&gt;right = root;</span><br><span class="line">    *pRoot = pivot;</span><br><span class="line">    UpdateHeight(root);</span><br><span class="line">    UpdateHeight(pivot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateL</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * root = *pRoot;</span><br><span class="line">    node * pivot = (*pRoot)-&gt;right;</span><br><span class="line"></span><br><span class="line">    root-&gt;right = pivot-&gt;left;</span><br><span class="line">    pivot-&gt;left =  root;</span><br><span class="line">    *pRoot = pivot;</span><br><span class="line">    UpdateHeight(root);</span><br><span class="line">    UpdateHeight(pivot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateLR</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    RotateL(&amp;((*pRoot)-&gt;left));</span><br><span class="line">    RotateR(pRoot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateRL</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    RotateR(&amp;((*pRoot)-&gt;right));</span><br><span class="line">    RotateL(pRoot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> node* <span class="title">FindMin</span><span class="params">(node * root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = root;</span><br><span class="line">    <span class="keyword">while</span>(n-&gt;left)</span><br><span class="line">        n = n-&gt;left;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(node ** pPtr, <span class="keyword">int</span> data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="keyword">if</span>(!n)</span><br><span class="line">        *pPtr = <span class="keyword">new</span> node(data);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(data &lt; n-&gt;data)</span><br><span class="line">    &#123;</span><br><span class="line">        Insert(&amp;n-&gt;left, data);</span><br><span class="line">        <span class="keyword">if</span>(Height(n-&gt;left)-Height(n-&gt;right)&gt;=<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//if(Height(n-&gt;left-&gt;left)&gt;=Height(n-&gt;left-&gt;right))</span></span><br><span class="line">            <span class="keyword">if</span>(data &lt; n-&gt;left-&gt;data)</span><br><span class="line">                RotateR(pPtr);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                RotateLR(pPtr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n-&gt;data &lt; data)</span><br><span class="line">    &#123;</span><br><span class="line">        Insert(&amp;n-&gt;right, data);</span><br><span class="line">        <span class="keyword">if</span>(Height(n-&gt;right)-Height(n-&gt;left)&gt;=<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//if(Height(n-&gt;right-&gt;right)&gt;=Height(n-&gt;right-&gt;left))</span></span><br><span class="line">            <span class="keyword">if</span>(n-&gt;right-&gt;data &lt; data)</span><br><span class="line">                RotateL(pPtr);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                RotateRL(pPtr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    UpdateHeight(*pPtr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Remove</span><span class="params">(node ** pRoot, <span class="keyword">int</span> data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pRoot;</span><br><span class="line">    <span class="keyword">if</span>(!n)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(data &lt; n-&gt;data)</span><br><span class="line">    &#123;</span><br><span class="line">        Remove(&amp;n-&gt;left, data);</span><br><span class="line">        UpdateHeight(n);</span><br><span class="line">        <span class="keyword">if</span>(Height(n-&gt;right)-Height(n-&gt;left) == <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Height(n-&gt;right-&gt;right) &gt;= Height(n-&gt;right-&gt;left))</span><br><span class="line">                RotateL(pRoot);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                RotateRL(pRoot);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n-&gt;data &lt; data)</span><br><span class="line">    &#123;</span><br><span class="line">        Remove(&amp;n-&gt;right, data);</span><br><span class="line">        UpdateHeight(n);</span><br><span class="line">        <span class="keyword">if</span>(Height(n-&gt;left)-Height(n-&gt;right)==<span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Height(n-&gt;left-&gt;left)&gt;=Height(n-&gt;left-&gt;right))</span><br><span class="line">                RotateR(pRoot);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                RotateLR(pRoot);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(n-&gt;left &amp;&amp; n-&gt;right)</span><br><span class="line">        &#123;</span><br><span class="line">            node * victim = FindMin(n-&gt;right);</span><br><span class="line">            n-&gt;data = victim-&gt;data;</span><br><span class="line">            Remove(&amp;n-&gt;right, n-&gt;data);</span><br><span class="line">            UpdateHeight(n);</span><br><span class="line">            <span class="keyword">if</span>(Height(n-&gt;left)-Height(n-&gt;right)==<span class="number">2</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(Height(n-&gt;left-&gt;left)&gt;=Height(n-&gt;left-&gt;right))</span><br><span class="line">                    RotateR(pRoot);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    RotateLR(pRoot);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            node * old = n;</span><br><span class="line">            *pRoot = n-&gt;left?n-&gt;left:n-&gt;right;</span><br><span class="line">            <span class="keyword">delete</span> old;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将一些重复操作合并精简后：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">height</span>;</span><br><span class="line">    node * left, * right;</span><br><span class="line">    node(<span class="keyword">int</span> data):data(data), <span class="built_in">height</span>(<span class="number">0</span>), left(<span class="literal">nullptr</span>), right(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Height</span><span class="params">(node * root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> root?root-&gt;<span class="built_in">height</span>:<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">UpdateHeight</span><span class="params">(node * root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    root-&gt;<span class="built_in">height</span> = <span class="built_in">max</span>(Height(root-&gt;left), Height(root-&gt;right))+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateR</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * root = *pRoot;</span><br><span class="line">    node * pivot = (*pRoot)-&gt;left;</span><br><span class="line"></span><br><span class="line">    root-&gt;left = pivot-&gt;right;</span><br><span class="line">    pivot-&gt;right = root;</span><br><span class="line">    *pRoot = pivot;</span><br><span class="line">    UpdateHeight(root);</span><br><span class="line">    UpdateHeight(pivot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateL</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * root = *pRoot;</span><br><span class="line">    node * pivot = (*pRoot)-&gt;right;</span><br><span class="line"></span><br><span class="line">    root-&gt;right = pivot-&gt;left;</span><br><span class="line">    pivot-&gt;left =  root;</span><br><span class="line">    *pRoot = pivot;</span><br><span class="line">    UpdateHeight(root);</span><br><span class="line">    UpdateHeight(pivot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateLR</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    RotateL(&amp;((*pRoot)-&gt;left));</span><br><span class="line">    RotateR(pRoot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateRL</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    RotateR(&amp;((*pRoot)-&gt;right));</span><br><span class="line">    RotateL(pRoot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> node* <span class="title">FindMin</span><span class="params">(node * root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = root;</span><br><span class="line">    <span class="keyword">while</span>(n-&gt;left)</span><br><span class="line">        n = n-&gt;left;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">BalanceLeft</span><span class="params">(node ** pPtr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="keyword">if</span>(Height(n-&gt;left)-Height(n-&gt;right)&gt;=<span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Height(n-&gt;left-&gt;left)&gt;=Height(n-&gt;left-&gt;right))</span><br><span class="line">            RotateR(pPtr);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            RotateLR(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">BalanceRight</span><span class="params">(node ** pPtr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="keyword">if</span>(Height(n-&gt;right)-Height(n-&gt;left)&gt;=<span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Height(n-&gt;right-&gt;right)&gt;=Height(n-&gt;right-&gt;left))</span><br><span class="line">            RotateL(pPtr);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            RotateRL(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(node ** pPtr, <span class="keyword">int</span> data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="keyword">if</span>(!n)</span><br><span class="line">        *pPtr = <span class="keyword">new</span> node(data);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(data &lt; n-&gt;data)</span><br><span class="line">    &#123;</span><br><span class="line">        Insert(&amp;n-&gt;left, data);</span><br><span class="line">        BalanceLeft(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n-&gt;data &lt; data)</span><br><span class="line">    &#123;</span><br><span class="line">        Insert(&amp;n-&gt;right, data);</span><br><span class="line">        BalanceRight(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">    UpdateHeight(*pPtr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Remove</span><span class="params">(node ** pPtr, <span class="keyword">int</span> data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="keyword">if</span>(!n)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(data &lt; n-&gt;data)</span><br><span class="line">    &#123;</span><br><span class="line">        Remove(&amp;n-&gt;left, data);</span><br><span class="line">        UpdateHeight(n);</span><br><span class="line">        BalanceRight(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n-&gt;data &lt; data)</span><br><span class="line">    &#123;</span><br><span class="line">        Remove(&amp;n-&gt;right, data);</span><br><span class="line">        UpdateHeight(n);</span><br><span class="line">        BalanceLeft(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(n-&gt;left &amp;&amp; n-&gt;right)</span><br><span class="line">    &#123;</span><br><span class="line">        node * victim = FindMin(n-&gt;right);</span><br><span class="line">        n-&gt;data = victim-&gt;data;</span><br><span class="line">        Remove(&amp;n-&gt;right, n-&gt;data);</span><br><span class="line">        UpdateHeight(n);</span><br><span class="line">        BalanceLeft(pPtr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        node * old = n;</span><br><span class="line">        *pPtr = n-&gt;left?n-&gt;left:n-&gt;right;</span><br><span class="line">        <span class="keyword">delete</span> old;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="以bf作为平衡判断条件"><a href="#以bf作为平衡判断条件" class="headerlink" title="以bf作为平衡判断条件"></a>以bf作为平衡判断条件</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LH 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EH 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RH -1</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="keyword">int</span> bf;</span><br><span class="line">    node * left, *right;</span><br><span class="line">    node(<span class="keyword">int</span> data) :data(data), bf(EH), left(<span class="literal">nullptr</span>), right(<span class="literal">nullptr</span>) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateR</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * root = *pRoot;</span><br><span class="line">    node * pivot = (*pRoot)-&gt;left;</span><br><span class="line"></span><br><span class="line">    root-&gt;left = pivot-&gt;right;</span><br><span class="line">    pivot-&gt;right = root;</span><br><span class="line">    *pRoot = pivot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateL</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * root = *pRoot;</span><br><span class="line">    node * pivot = (*pRoot)-&gt;right;</span><br><span class="line"></span><br><span class="line">    root-&gt;right = pivot-&gt;left;</span><br><span class="line">    pivot-&gt;left = root;</span><br><span class="line">    *pRoot = pivot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateLR</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    RotateL(&amp;((*pRoot)-&gt;left));</span><br><span class="line">    RotateR(pRoot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RotateRL</span><span class="params">(node ** pRoot)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    RotateR(&amp;((*pRoot)-&gt;right));</span><br><span class="line">    RotateL(pRoot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> node * <span class="title">FindMin</span><span class="params">(node * root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = root;</span><br><span class="line">    <span class="keyword">while</span> (n-&gt;left)</span><br><span class="line">        n = n-&gt;left;</span><br><span class="line">    <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">InsertBalanceLeft</span><span class="params">(node ** pPtr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    node * l = n-&gt;left;</span><br><span class="line">    <span class="keyword">switch</span> (l-&gt;bf)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> LH:</span><br><span class="line">        n-&gt;bf = l-&gt;bf = EH;</span><br><span class="line">        RotateR(pPtr);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> RH:</span><br><span class="line">        node * lr = l-&gt;right;</span><br><span class="line">        <span class="keyword">switch</span> (lr-&gt;bf)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> LH:</span><br><span class="line">            n-&gt;bf = RH;</span><br><span class="line">            l-&gt;bf = EH;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> EH:</span><br><span class="line">            n-&gt;bf = l-&gt;bf = EH;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> RH:</span><br><span class="line">            n-&gt;bf = EH;</span><br><span class="line">            l-&gt;bf = LH;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        lr-&gt;bf = EH;</span><br><span class="line">        RotateLR(pPtr);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">InsertBalanceRight</span><span class="params">(node ** pPtr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    node * r = n-&gt;right;</span><br><span class="line">    <span class="keyword">switch</span> (r-&gt;bf)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> RH:</span><br><span class="line">        n-&gt;bf = r-&gt;bf = EH;</span><br><span class="line">        RotateL(pPtr);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> LH:</span><br><span class="line">        node * rl = r-&gt;left;</span><br><span class="line">        <span class="keyword">switch</span> (rl-&gt;bf)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> RH:</span><br><span class="line">            n-&gt;bf = LH;</span><br><span class="line">            r-&gt;bf = EH;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> EH:</span><br><span class="line">            n-&gt;bf = r-&gt;bf = EH;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LH:</span><br><span class="line">            n-&gt;bf = EH;</span><br><span class="line">            r-&gt;bf = RH;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        rl-&gt;bf = EH;</span><br><span class="line">        RotateRL(pPtr);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(node ** pPtr, <span class="keyword">int</span> data, <span class="keyword">bool</span> * taller)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="keyword">if</span> (!n)</span><br><span class="line">    &#123;</span><br><span class="line">        *pPtr = <span class="keyword">new</span> node(data);</span><br><span class="line">        *taller = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (data &lt; n-&gt;data)</span><br><span class="line">    &#123;</span><br><span class="line">        Insert(&amp;n-&gt;left, data, taller);</span><br><span class="line">        <span class="keyword">if</span> (*taller)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">switch</span> (n-&gt;bf)</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">case</span> LH:</span><br><span class="line">                InsertBalanceLeft(pPtr);</span><br><span class="line">                *taller = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> EH:</span><br><span class="line">                n-&gt;bf = LH;</span><br><span class="line">                *taller = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RH:</span><br><span class="line">                n-&gt;bf = EH;</span><br><span class="line">                *taller = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n-&gt;data &lt; data)</span><br><span class="line">    &#123;</span><br><span class="line">        Insert(&amp;n-&gt;right, data, taller);</span><br><span class="line">        <span class="keyword">if</span> (*taller)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">switch</span> (n-&gt;bf)</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">case</span> LH:</span><br><span class="line">                n-&gt;bf = EH;</span><br><span class="line">                *taller = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> EH:</span><br><span class="line">                n-&gt;bf = RH;</span><br><span class="line">                *taller = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RH:</span><br><span class="line">                InsertBalanceRight(pPtr);</span><br><span class="line">                *taller = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RemoveBalanceLeft</span><span class="params">(node ** pPtr, <span class="keyword">bool</span> * lower)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    node * l = n-&gt;left;</span><br><span class="line">    *lower = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">switch</span> (l-&gt;bf)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> EH:</span><br><span class="line">        n-&gt;bf = LH;</span><br><span class="line">        l-&gt;bf = RH;</span><br><span class="line">        RotateR(pPtr);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> LH:</span><br><span class="line">        n-&gt;bf = l-&gt;bf = EH;</span><br><span class="line">        RotateR(pPtr);</span><br><span class="line">        *lower = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> RH:</span><br><span class="line">        node * lr = l-&gt;right;</span><br><span class="line">        <span class="keyword">switch</span> (lr-&gt;bf)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> LH:</span><br><span class="line">            n-&gt;bf = RH;</span><br><span class="line">            l-&gt;bf = EH;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> EH:</span><br><span class="line">            n-&gt;bf = l-&gt;bf = EH;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> RH:</span><br><span class="line">            n-&gt;bf = EH;</span><br><span class="line">            l-&gt;bf = LH;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        lr-&gt;bf = EH;</span><br><span class="line">        RotateLR(pPtr);</span><br><span class="line">        *lower = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RemoveBalanceRight</span><span class="params">(node ** pPtr, <span class="keyword">bool</span> * lower)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    node * r = n-&gt;right;</span><br><span class="line">    *lower = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">switch</span> (r-&gt;bf)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> EH:</span><br><span class="line">        n-&gt;bf = RH;</span><br><span class="line">        r-&gt;bf = LH;</span><br><span class="line">        RotateL(pPtr);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> RH:</span><br><span class="line">        n-&gt;bf = r-&gt;bf = EH;</span><br><span class="line">        RotateL(pPtr);</span><br><span class="line">        *lower = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> LH:</span><br><span class="line">        node * rl = r-&gt;left;</span><br><span class="line">        <span class="keyword">switch</span> (rl-&gt;bf)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> RH:</span><br><span class="line">            n-&gt;bf = LH;</span><br><span class="line">            r-&gt;bf = EH;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> EH:</span><br><span class="line">            n-&gt;bf = r-&gt;bf = EH;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> LH:</span><br><span class="line">            n-&gt;bf = EH;</span><br><span class="line">            r-&gt;bf = RH;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        rl-&gt;bf = EH;</span><br><span class="line">        RotateRL(pPtr);</span><br><span class="line">        *lower = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Remove</span><span class="params">(node ** pPtr, <span class="keyword">int</span> data, <span class="keyword">bool</span> * lower)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    node * n = *pPtr;</span><br><span class="line">    <span class="keyword">if</span> (!n)</span><br><span class="line">    &#123;</span><br><span class="line">        *lower = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (data &lt; n-&gt;data)</span><br><span class="line">    &#123;</span><br><span class="line">        Remove(&amp;n-&gt;left, data, lower);</span><br><span class="line">        <span class="keyword">if</span> (*lower)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">switch</span> (n-&gt;bf)</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">case</span> LH:</span><br><span class="line">                n-&gt;bf = EH;</span><br><span class="line">                *lower = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> EH:</span><br><span class="line">                n-&gt;bf = RH;</span><br><span class="line">                *lower = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RH:</span><br><span class="line">                RemoveBalanceRight(pPtr, lower);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n-&gt;data &lt; data)</span><br><span class="line">    &#123;</span><br><span class="line">        Remove(&amp;n-&gt;right, data, lower);</span><br><span class="line">        <span class="keyword">if</span> (*lower)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">switch</span> (n-&gt;bf)</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">case</span> LH:</span><br><span class="line">                RemoveBalanceLeft(pPtr, lower);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> EH:</span><br><span class="line">                n-&gt;bf = LH;</span><br><span class="line">                *lower = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RH:</span><br><span class="line">                n-&gt;bf = EH;</span><br><span class="line">                *lower = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n-&gt;left &amp;&amp; n-&gt;right)</span><br><span class="line">    &#123;</span><br><span class="line">        node * victim = FindMin(n-&gt;right);</span><br><span class="line">        n-&gt;data = victim-&gt;data;</span><br><span class="line">        Remove(&amp;n-&gt;right, n-&gt;data, lower);</span><br><span class="line">        <span class="keyword">if</span> (*lower)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">switch</span> (n-&gt;bf)</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">case</span> LH:</span><br><span class="line">                RemoveBalanceLeft(pPtr, lower);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> EH:</span><br><span class="line">                n-&gt;bf = LH;</span><br><span class="line">                *lower = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> RH:</span><br><span class="line">                n-&gt;bf = EH;</span><br><span class="line">                *lower = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        node * old = n;</span><br><span class="line">        *pPtr = n-&gt;left ? n-&gt;left : n-&gt;right;</span><br><span class="line">        <span class="keyword">delete</span> old;</span><br><span class="line">        *lower = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="判断是否为AVL树"><a href="#判断是否为AVL树" class="headerlink" title="判断是否为AVL树"></a>判断是否为AVL树</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsBalancedImpl</span><span class="params">(node* root, <span class="keyword">int</span> &amp; h)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h1, h2;</span><br><span class="line">    h1 = h2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;left &amp;&amp; !IsBalancedImpl(root-&gt;left, h1))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;right &amp;&amp; !IsBalancedImpl(root-&gt;right, h2))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    h = <span class="built_in">max</span>(h1, h2) + <span class="number">1</span>;</span><br><span class="line">    assert(root-&gt;bf == (h1 - h2));</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(h1 - h2) &lt;= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsBalanced</span><span class="params">(node* root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!root)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">int</span> h = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> IsBalancedImpl(root, h);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsValidBSTImpl</span><span class="params">(node* root, <span class="keyword">int</span> &amp; last, <span class="keyword">bool</span> &amp; lastValid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;left &amp;&amp; !IsValidBSTImpl(root-&gt;left, last, lastValid))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (lastValid &amp;&amp; last &gt;= root-&gt;data)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    last = root-&gt;data;</span><br><span class="line">    lastValid = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;right &amp;&amp; !IsValidBSTImpl(root-&gt;right, last, lastValid))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">IsValidBST</span><span class="params">(node* root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!root)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">int</span> last;</span><br><span class="line">    <span class="keyword">bool</span> lastValid = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> IsValidBSTImpl(root, last, lastValid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IsBBST</span><span class="params">(node * root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> IsBalanced(root) &amp;&amp; IsValidBST(root);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://github.com/i-square/Data-Structure/blob/master/Chapter04/AVLTree.h" target="_blank" rel="noopener">github上某源码</a>  </p>
 
</div>
            </div>
        </div>
        <div class="foot"><div id="footer">
    <div class="theme-info">
        <span>theme:<a href="https://github.com/12-th/ezread" target="_blank" rel="noopener">ezread</a></span>
    </div>
    <div class="about-me">
        <span>想要给主题push request？<a href="https://github.com/12-th/" target="_blank" rel="noopener">contact me!!!!</a></span>
    </div>
</div> </div>
    </div>
    <div class="btn-to-top"><div id="btn-to-top">
    <span id="btn-to-top">&#8679;</span>
</div></div>
    <!-- <span id='btn-content'>&#8678;</span> -->
</div>


</body>

</html>